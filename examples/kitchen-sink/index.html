<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1">
	<title>lil-gui - Kitchen Sink</title>
	<style>
		* {
			box-sizing: border-box;
		}

		html,
		body,
		#container {
			height: 100%;
		}

		body {
			margin: 0;
			padding: 0;
		}

		#container {
			padding: 1rem;
			display: flex;
			flex-direction: column;
			flex-wrap: wrap;
			align-content: flex-start;
		}

		#container>* {
			flex-shrink: 0;
			margin-bottom: 1rem;
			margin-right: 1rem;
		}

	</style>
</head>
<body>
	<div id="container"></div>
	<script type="module">
		import GUI from '../../dist/lil-gui.esm.js';

		const myObject = {
			options: 10,
			boolean: true,
			string: 'lil-gui',
			number: 0.5,
			color: '#aa00ff',
			hide() {
				autoPlaceGUI.domElement.style.display = 'none';
				location.hash = '#hide';
			}
		};

		const autoPlaceGUI = new GUI( { title: 'autoPlace' } );

		autoPlaceGUI.add( myObject, 'options', { Small: 1, Medium: 10, Large: 100 } );
		autoPlaceGUI.add( myObject, 'boolean' );
		autoPlaceGUI.add( myObject, 'string' );
		autoPlaceGUI.add( myObject, 'number', 0, 1 );
		autoPlaceGUI.addColor( myObject, 'color' );
		autoPlaceGUI.add( myObject, 'hide' );

		const container = document.getElementById( 'container' );

		if ( location.hash === '#long' ) {
			for ( let i = 0; i < 50; i++ ) {
				autoPlaceGUI.add( { x: i / 49 }, 'x', 0, 1 );
			}
		}

		if ( location.hash === '#hide' ) {
			myObject.hide();
		}

		/**
		 * @param {object} options
		 * @param {function(GUI)} callback
		 */
		function make( options, callback ) {
			options.container = container;
			callback( new GUI( options ) );
		}

		make( { title: 'Numbers' }, gui => {

			gui.add( { x: 0 }, 'x' ).name( 'No Parameters' );
			gui.add( { x: 0 }, 'x', 0 ).name( 'Min' );
			gui.add( { x: 0 }, 'x' ).max( 0 ).name( 'Max' );

			const guiStep = gui.addFolder( 'Step' );

			guiStep.add( { x: 0 }, 'x' ).step( 0.01 ).name( '0.01' );
			guiStep.add( { x: 0 }, 'x' ).step( 0.1 ).name( '0.1' );
			guiStep.add( { x: 0 }, 'x' ).step( 1 ).name( '1' );
			guiStep.add( { x: 0 }, 'x' ).step( 10 ).name( '10' );

		} );

		make( { title: 'Sliders' }, gui => {

			const guiImplicit = gui.addFolder( 'Implicit step' );

			const implicitStep = ( min, max ) => {
				guiImplicit.add( { x: max }, 'x', min, max ).name( `[${min},${max}]` );
			};

			implicitStep( 0, 1 );
			implicitStep( 0, 100 );
			implicitStep( -1, 1 );
			implicitStep( 0, 3 );
			implicitStep( 0, 5 );
			implicitStep( 0, 7 );
			implicitStep( 0, 15 );
			implicitStep( 0, 1e32 );

			const guiExplicit = gui.addFolder( 'Explicit step' );

			const explicitStep = ( min, max, step, label = step ) => {
				guiExplicit.add( { x: max }, 'x', min, max, step ).name( `[${min},${max}] step ${label}` );
			};

			explicitStep( 0, 100, 1 );
			explicitStep( 0, 1, 0.1 );
			explicitStep( -1, 1, 0.25 );
			explicitStep( 1, 16, .01 );
			explicitStep( 0, 15, .015 );
			explicitStep( 0, 5, 1 / 3, '1/3' );

		} );

		make( { title: 'Options' }, gui => {

			gui.add( { x: 0 }, 'x', [0, 1, 2] ).name( 'Array' );
			gui.add( { x: 0 }, 'x', { Label1: 0, Label2: 1, Label3: 2 } ).name( 'Object' );
			gui.add( { x: {} }, 'x', [0, 1, 2] ).name( 'Invalid initial' );
			gui.add( { x: {} }, 'x', { Label1: 0, Label2: 1, Label3: 2 } ).name( 'Invalid initial' );

			const longString = 'Anoptionorvaluewithaproblematicallylongname';
			gui.add( { x: longString }, 'x', [longString, 1, 2] ).name( 'Long names' );

		} );

		make( { title: 'Colors' }, gui => {

			gui.addColor( { x: 0xaa00ff }, 'x' ).name( 'Hex Integer' );
			gui.addColor( { x: { r: 2 / 3, g: 0, b: 1 } }, 'x' ).name( '{r,g,b} 0-1' );
			gui.addColor( { x: [2 / 3, 0, 1] }, 'x' ).name( '[r,g,b] 0-1' );

			const guiStrings = gui.addFolder( 'Strings' );

			const colorString = str => guiStrings.addColor( { x: str }, 'x' ).name( `"${str}"` );

			colorString( '#aa00Ff' );
			colorString( 'aa00Ff' );
			colorString( '0xaa00Ff' );
			colorString( '#a0f' );
			colorString( 'a0f' );
			colorString( 'rgb(170, 0, 255)' );

			const guiRGBScale = gui.addFolder( 'RGB Scale' );

			guiRGBScale.addColor( { x: [170, 0, 255] }, 'x', 255 ).name( '{r,g,b} 0-255' );
			guiRGBScale.addColor( { x: { r: 170, g: 0, b: 255 } }, 'x', 255 ).name( '[r,g,b] 0-255' );

		} );

		make( { title: 'Folders' }, gui => {

			const folder1 = gui.addFolder( 'Folder' );
			addFiller( folder1 );

			addFiller( gui );

			const folder2 = gui.addFolder( 'Closed Folder' ).close();

			addFiller( folder2 );

			gui.addFolder( 'Empty Folder' );

			const folder3 = gui.addFolder( 'Folder' );

			addFiller( folder3 );

			const folder4 = folder3.addFolder( 'Nested Folder' );

			addFiller( folder4 );

			folder4.addFolder( 'Nested Folder' );

			addFiller( folder4 );

			function getDepth( g ) {
				let depth = 0;
				while ( g !== g.root ) {
					g = g.parent;
					depth++;
				}
				return depth;
			}

			function addFiller( g ) {
				const nested = getDepth( g ) > 0 ? 'Nested ' : '';
				g.add( { x: 0.5 }, 'x', 0, 1 ).name( `${nested}Slider` );
				g.add( { x: true }, 'x' ).name( `${nested}Boolean` );
				g.add( { x: function () { } }, 'x' ).name( `${nested}Button` );
			}
		} );

		make( { title: 'Disable' }, gui => {

			gui.add( { Number: 0 }, 'Number' ).disable().enable();
			gui.add( { Number: 0 }, 'Number' ).disable();

			gui.add( { Slider: 0 }, 'Slider', 0, 1 ).disable().enable();
			gui.add( { Slider: 0 }, 'Slider', 0, 1 ).disable();

			gui.add( { String: 'foo' }, 'String' ).disable().enable();
			gui.add( { String: 'foo' }, 'String' ).disable();

			gui.add( { Boolean: true }, 'Boolean' ).disable().enable();
			gui.add( { Boolean: true }, 'Boolean' ).disable();

			gui.add( { Options: 'a' }, 'Options', ['a', 'b', 'c'] ).disable().enable();
			gui.add( { Options: 'a' }, 'Options', ['a', 'b', 'c'] ).disable();

			gui.add( { func() { console.log( 'hi' ) } }, 'func' ).name( 'Function' ).disable().enable();
			gui.add( { func() { console.log( 'hi' ) } }, 'func' ).name( 'Function' ).disable();

			gui.addColor( { Color: 0xaa00ff }, 'Color' ).disable().enable();
			gui.addColor( { Color: 0xaa00ff }, 'Color' ).disable();

		} );

		make( { title: 'Listen' }, gui => {

			const params = { animate: true };

			gui.add( params, 'animate' )

			function listenTester( name, cycle, ...addArgs ) {

				const obj = {};
				obj[name] = cycle[cycle.length - 1];
				gui.add( obj, name, ...addArgs ).listen();
				let index = 0;

				const loop = () => {

					if ( params.animate ) obj[name] = cycle[index];
					if ( ++index > cycle.length - 1 ) {
						index = 0;
					}

					setTimeout( loop, 1000 );

				};

				loop();

			}

			listenTester( 'Number', [1, 2, 3, 4, 5] );
			listenTester( 'Slider', [5, 4, 3, 2, 1], 1, 5 );

			listenTester( 'String', ['foo', 'bar', 'baz'] );
			listenTester( 'Boolean', [true, false] );

			listenTester( 'Options', ['a', 'b', 'c'], ['a', 'b', 'c'] );

			gui.add = gui.addColor; // hehe
			listenTester( 'Color', [0xaa00ff, 0x00aaff, 0xffaa00] );

		} );

		make( { title: 'onChange' }, gui => {

			const tallies = { onChange: 0, onFinishChange: 0 };

			function change() {
				console.log( this.property + ' onChange' );
				tallies.onChange++;
			}

			function finishChange() {
				console.log( this.property + ' onFinishChange' );
				tallies.onFinishChange++;
			}

			let folder;

			folder = gui.addFolder('Tallies');
			folder.add( tallies, 'onChange' ).disable().listen();
			folder.add( tallies, 'onFinishChange' ).disable().listen();

			gui.add( { Number: 0 }, 'Number' ).onChange( change ).onFinishChange( finishChange );

			gui.add( { Slider: 0 }, 'Slider', 0, 1 ).onChange( change ).onFinishChange( finishChange );

			gui.add( { String: 'foo' }, 'String' ).onChange( change ).onFinishChange( finishChange );

			gui.add( { Boolean: true }, 'Boolean' ).onChange( change ).onFinishChange( finishChange );

			gui.add( { Options: 'a' }, 'Options', ['a', 'b', 'c'] ).onChange( change ).onFinishChange( finishChange );

			gui.add( { func() { console.log( 'hi' ) } }, 'func' ).onChange( change ).onFinishChange( finishChange );

			gui.addColor( { Color: 0xaa00ff }, 'Color' ).onChange( change ).onFinishChange( finishChange );

			gui.onFinishChange( e => {
				console.log( 'gui.onFinishChange', e );
			} );

		} );

		make( { title: 'Customization' }, gui => {

			const pre = document.createElement( 'pre' );
			pre.id = 'custom-css';
			container.appendChild( pre );

			const styleTag = document.createElement( 'style' );
			document.head.appendChild( styleTag );

			function update() {
				let style = '';
				for ( let prop in stylesheet ) {
					const value = stylesheet[prop];
					if ( value === original[prop] ) continue;
					style += `\t${prop}: ${value};\n`;
				}
				if ( style ) {
					style = '.lil-gui {\n' + style + '}';
					pre.innerHTML = style;
					styleTag.innerHTML = style;
				} else {
					pre.innerHTML = '';
					styleTag.innerHTML = '';
				}
			}

			const original = {};

			const stylesheet = new Proxy( {}, {
				set( target, property, value ) {
					if ( !( property in target ) ) {
						original[property] = value;
					}
					target[property] = value;
					update();
					return true;
				},
				get( target, property ) {
					return target[property];
				}
			} );

			const Default = {};
			const themes = {
				Default,
				Light: {
					'--background-color': '#f6f6f6',
					'--text-color': '#3d3d3d',
					'--title-background-color': '#efefef',
					'--title-text-color': '#3d3d3d',
					'--widget-color': '#eaeaea',
					'--hover-color': '#f0f0f0',
					'--focus-color': '#fafafa',
					'--number-color': '#07aacf',
					'--string-color': '#8da300'
				},
				'Solarized~ Light': {
					'--background-color': '#fdf6e3',
					'--text-color': '#657b83',
					'--title-background-color': '#f5efdc',
					'--title-text-color': '#657b83',
					'--widget-color': '#eee8d5',
					'--hover-color': '#e7e1cf',
					'--focus-color': '#e6ddc7',
					'--number-color': '#2aa0f3',
					'--string-color': '#97ad00'
				},
				'Solarized~ Dark': {
					'--background-color': '#002b36',
					'--text-color': '#b2c2c2',
					'--title-background-color': '#001f27',
					'--title-text-color': '#b2c2c2',
					'--widget-color': '#094e5f',
					'--hover-color': '#0a6277',
					'--focus-color': '#0b6c84',
					'--number-color': '#2aa0f2',
					'--string-color': '#97ad00'
				},
				'Tennis': {
					'--background-color': '#32405e',
					'--text-color': '#ebe193',
					'--title-background-color': '#713154',
					'--title-text-color': '#ffffff',
					'--widget-color': '#057170',
					'--hover-color': '#057170',
					'--focus-color': '#b74f88',
					'--number-color': '#ddfcff',
					'--string-color': '#ffbf00'
				}
			};

			gui.add( { theme: Default }, 'theme', themes )
				.name( 'Themes' )
				.onChange( v => {
					if ( v === Default ) {
						colors.reset();
						allVariables.reset();
					} else {
						colors.load( { controllers: v } );
					}
				} );

			const style = Array.from( document.querySelectorAll( 'style' ) ).find( v => /lil-gui/.test( v.innerHTML ) );

			const colors = gui.addFolder( 'Colors' );
			const allVariables = gui.addFolder( 'All Variables' ).close();

			style.innerHTML.replace( /(--[a-z0-9-]+)\s*:\s*([^;}]*)[;}]/ig, function ( $0, property, value ) {

				if ( !( property in stylesheet ) ) {

					stylesheet[property] = value;

					if ( /color$/.test( property ) ) {
						colors.addColor( stylesheet, property );
					} else if ( /^\d+px$/.test( value ) ) {
						const anon = {};
						const initial = parseFloat( value.replace( 'px', '' ) );
						anon[property] = initial;
						allVariables.add( anon, property ).min( 0 ).step( 1 ).onChange( v => stylesheet[property] = v + 'px' );
					} else if ( /%$/.test( value ) ) {
						const anon = {};
						const initial = parseFloat( value.replace( '%', '' ) );
						anon[property] = initial;
						// allVariables.add( anon, property, 0, 100 )
						allVariables.add( anon, property )
							.onChange( v => stylesheet[property] = v + '%' );
					} else {
						allVariables.add( stylesheet, property );
					}

				}

			} );

		} );

	</script>
</body>
</html>
